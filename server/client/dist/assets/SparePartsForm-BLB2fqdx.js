import{r as f,s as h,j as a,q,u as c,F as x}from"./index-Bgw3TDtt.js";import{f as b,F as R}from"./faPenToSquare-vXjp4h8H.js";import{u as y}from"./aws-eKdh3-Wd.js";const F=(s,r,o)=>[{name:"supplier_id",label:"Supplier",type:"select",options:Array.isArray(s)?s.map(l=>({label:l.name,value:l.id})):[],placeholder:"Select supplier",defaultValue:r==null?void 0:r.supplier_id},{name:"name",label:"Name",type:"text",placeholder:"Enter name",defaultValue:r==null?void 0:r.name},{name:"parts_image",label:"Parts Image ",type:"file",placeholder:"Upload parts image"},{name:"spare_parts_link_type",label:"Spare Parts Link Type",type:"select",options:[{value:"url",label:"URL"},{value:"file",label:"File Upload"}],defaultValue:o?"file":"url"},o?{name:"spare_parts_file_link",label:"Spare Parts Link File",type:"file",accept:".pdf,.doc,.docx"}:{name:"spare_parts_url_link",label:"Spare Parts Link",type:"text",placeholder:"Enter URL or select file",defaultValue:(r==null?void 0:r.spare_parts_link)||""}],M=({id:s,sparepart:r,suppliers:o})=>{const[u,l]=f.useState(!1),[p,S]=f.useState(!1),j=r?F(o,r,p):F(o,void 0,p),{mutateAsync:k,isError:v,error:E,isPending:P}=h("spareparts"),{mutateAsync:L,isError:U,error:w,isPending:T}=h("spareparts",s),d=s?w:E,g=s?U:v,V=s?L:k;async function D(e){e.preventDefault();const n=new FormData(e.currentTarget),t=n.get("parts_image"),m=n.get("spare_parts_file_link"),A=n.get("spare_parts_url_link"),C=m?m.name:A,N={supplier_id:n.get("supplier_id"),name:n.get("name"),parts_image:t?t.name:"null",spare_parts_link:C};try{const i=await V(N);if(t){const _={imageFile:t,presignedUrl:i.presignedUrl};await y(_)}if(p&&m){const _={imageFile:m,presignedUrl:i.presignedLinkUrl};await y(_)}i&&!g&&l(!1)}catch(i){console.error("error creating sparepart",i)}}return P||T?a.jsx(q,{}):a.jsxs("section",{id:"form",children:[a.jsx("button",{className:c.btnForm,onClick:()=>l(!u),children:s?a.jsx(x,{icon:b.faPenToSquare}):a.jsxs("div",{children:["Create Sparepart",a.jsx(x,{icon:b.faPenToSquare})]})}),a.jsxs(R,{visible:u,onClose:()=>l(!1),children:[a.jsxs("form",{className:c.form,onSubmit:D,encType:"multipart/form-data",children:[a.jsx("h1",{className:c.mainHeading,children:"Sparepart Form"}),j.map(e=>{var n;return a.jsxs("div",{children:[a.jsx("label",{htmlFor:e.name,children:e.label}),e.type==="select"||e.name==="spare_parts_link_type"?a.jsx("select",{name:e.name,id:e.name,onChange:e.name==="spare_parts_link_type"?t=>S(t.target.value==="file"):void 0,value:e.name==="spare_parts_link_type"&&p?"file":e.defaultValue,children:(n=e.options)==null?void 0:n.map(t=>a.jsx("option",{value:t.value,children:t.label},t.value))}):a.jsx("input",{type:e.type,name:e.name,id:e.name,placeholder:e.placeholder,defaultValue:e.defaultValue})]},e.name)}),a.jsx("button",{className:c.btnForm,type:"submit",children:"Submit"})]}),g&&a.jsxs("p",{children:["Error: ",d==null?void 0:d.message]})]})]})};export{M as S};
